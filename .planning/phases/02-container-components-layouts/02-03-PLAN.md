---
phase: 02-container-components-layouts
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/Deck/Deck.tsx
  - src/components/Deck/Deck.types.ts
  - src/components/Deck/Deck.module.css
  - src/components/Deck/Deck.test.tsx
  - src/components/Deck/index.ts
  - src/components/CardStack/CardStack.tsx
  - src/components/CardStack/CardStack.types.ts
  - src/components/CardStack/CardStack.module.css
  - src/components/CardStack/CardStack.test.tsx
  - src/components/CardStack/CardStack.index.ts
  - src/components/DropZone/DropZone.tsx
  - src/components/DropZone/DropZone.types.ts
  - src/components/DropZone/DropZone.module.css
  - src/components/DropZone/DropZone.test.tsx
  - src/components/DropZone/index.ts
autonomous: true

must_haves:
  truths:
    - "Deck component shows visual stack of face-down cards with configurable count"
    - "Clicking the Deck fires onDraw event without managing card state internally"
    - "Deck shows configurable empty state when count reaches 0"
    - "CardStack displays overlapping cards with diagonal cascade offset and slight rotation"
    - "DropZone renders a visual container area with empty state options"
  artifacts:
    - path: "src/components/Deck/Deck.tsx"
      provides: "Deck container component"
      exports: ["Deck"]
      min_lines: 40
    - path: "src/components/Deck/Deck.types.ts"
      provides: "DeckProps, DeckRef interfaces"
      exports: ["DeckProps", "DeckRef"]
    - path: "src/components/CardStack/CardStack.tsx"
      provides: "CardStack container component"
      exports: ["CardStack"]
      min_lines: 40
    - path: "src/components/CardStack/CardStack.types.ts"
      provides: "CardStackProps interface"
      exports: ["CardStackProps"]
    - path: "src/components/DropZone/DropZone.tsx"
      provides: "DropZone visual container"
      exports: ["DropZone"]
    - path: "src/components/DropZone/DropZone.types.ts"
      provides: "DropZoneProps interface"
      exports: ["DropZoneProps"]
  key_links:
    - from: "src/components/Deck/Deck.tsx"
      to: "src/components/Card/Card.tsx"
      via: "renders face-down Card components"
      pattern: "<Card.*isFaceUp.*false"
    - from: "src/components/CardStack/CardStack.tsx"
      to: "src/utils/layout.ts"
      via: "uses calculateStackLayout"
      pattern: "import.*calculateStackLayout.*from.*utils"
    - from: "src/components/CardStack/CardStack.tsx"
      to: "src/components/Card/Card.tsx"
      via: "renders Card components"
      pattern: "<Card"
---

<objective>
Build the Deck, CardStack, and DropZone components. Deck shows a clickable pile of face-down cards with draw action. CardStack displays overlapping cards with cascade layout. DropZone provides a visual container for card drop targets (Phase 3 will add actual DnD). These three are simpler containers that run parallel to the Hand component (Plan 02).

Purpose: Complete the container component set. Deck is essential for any draw-based card game. CardStack handles discard piles, played cards, and generic stacking. DropZone is the visual foundation for Phase 3 drag-and-drop.

Output: Three tested components with types, styles, and barrel exports.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-container-components-layouts/02-CONTEXT.md
@.planning/phases/02-container-components-layouts/02-RESEARCH.md
@.planning/phases/02-container-components-layouts/02-01-SUMMARY.md
@src/components/Card/Card.tsx
@src/components/Card/Card.types.ts
@src/types/card.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Deck component with draw action and empty states</name>
  <files>
    src/components/Deck/Deck.tsx
    src/components/Deck/Deck.types.ts
    src/components/Deck/Deck.module.css
    src/components/Deck/Deck.test.tsx
    src/components/Deck/index.ts
  </files>
  <action>
    **1. Deck types (`src/components/Deck/Deck.types.ts`):**

    ```typescript
    import { ReactNode } from 'react';

    export type DeckEmptyState = 'none' | 'placeholder' | ReactNode;

    export interface DeckProps {
      /** Number of cards remaining. Controls visual stack thickness. */
      count: number;
      /** Fired when deck is clicked/tapped (draw action). */
      onDraw?: () => void;
      /** What to show when count is 0. Default: 'placeholder'. */
      emptyState?: DeckEmptyState;
      /** Additional CSS class. */
      className?: string;
    }

    export interface DeckRef {
      /** Programmatically trigger a draw (fires onDraw). */
      drawCard: () => void;
    }
    ```

    Key per CONTEXT.md: Deck fires event only (`onDraw`), developer handles card state.

    **2. Deck component (`src/components/Deck/Deck.tsx`):**

    Use `forwardRef` + `useImperativeHandle` pattern.

    Implementation:
    - Visual representation: Render a small stack of face-down Card components to create depth. Show `Math.min(count, 5)` visual layers (no need to render 52 cards).
    - Each layer offset by 1px x and y to create stacking effect.
    - Top card is clickable; onClick fires `onDraw` if count > 0.
    - When count === 0: render based on `emptyState` prop:
      - `'none'`: render nothing (container still exists but invisible)
      - `'placeholder'`: render a dashed outline card placeholder
      - `ReactNode`: render the custom content
    - Card count indicator: show count as small text badge at bottom-right corner of the deck.
    - `DeckRef.drawCard()`: calls `onDraw?.()` if count > 0.

    Set `Deck.displayName = 'Deck'`.

    **3. Deck styles (`src/components/Deck/Deck.module.css`):**

    ```css
    .deck {
      position: relative;
      isolation: isolate;
      cursor: pointer;
      /* Default size, can be overridden by parent */
      width: 120px;
    }

    .deck--empty {
      cursor: default;
    }

    .cardLayer {
      position: absolute;
      inset: 0;
    }

    .placeholder {
      aspect-ratio: 5 / 7;
      border: 2px dashed rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: rgba(0, 0, 0, 0.3);
    }

    .countBadge {
      position: absolute;
      bottom: -8px;
      right: -8px;
      background: #1a365d;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      z-index: 10;
    }
    ```

    **4. Barrel export (`src/components/Deck/index.ts`):**

    Export Deck, DeckProps, DeckRef, DeckEmptyState.

    **5. Deck tests (`src/components/Deck/Deck.test.tsx`):**

    - Renders visual card layers (up to 5) based on count
    - Clicking deck fires onDraw callback
    - Does not fire onDraw when count is 0
    - Shows placeholder when count=0 and emptyState='placeholder' (default)
    - Shows nothing when count=0 and emptyState='none'
    - Shows custom ReactNode when count=0 and emptyState is JSX
    - Ref drawCard() fires onDraw
    - Ref drawCard() does nothing when count=0
    - Shows count badge with correct number
    - Cards are rendered face-down (isFaceUp=false)
  </action>
  <verify>
    `npm test -- src/components/Deck/Deck.test.tsx` passes.
    `npx tsc --noEmit` passes.
  </verify>
  <done>
    Deck component renders face-down card stack, fires onDraw on click, handles empty states (none/placeholder/custom), shows count badge, and exposes drawCard via ref. All tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CardStack and DropZone components</name>
  <files>
    src/components/CardStack/CardStack.tsx
    src/components/CardStack/CardStack.types.ts
    src/components/CardStack/CardStack.module.css
    src/components/CardStack/CardStack.test.tsx
    src/components/CardStack/index.ts
    src/components/DropZone/DropZone.tsx
    src/components/DropZone/DropZone.types.ts
    src/components/DropZone/DropZone.module.css
    src/components/DropZone/DropZone.test.tsx
    src/components/DropZone/index.ts
  </files>
  <action>
    **PART A: CardStack component**

    **1. CardStack types (`src/components/CardStack/CardStack.types.ts`):**

    ```typescript
    import { CardInput } from '../../types';

    export interface CardStackProps {
      /** Cards to display in the stack. */
      cards: CardInput[];
      /** Horizontal offset per card in px. Default: 2. */
      offsetX?: number;
      /** Vertical offset per card in px. Default: 2. */
      offsetY?: number;
      /** Maximum rotation spread in degrees. Default: 3. */
      maxRotation?: number;
      /** Whether cards are face up. Default: true for top card, false for others. */
      faceUp?: boolean | 'top-only';
      /** Fired when top card is clicked. */
      onTopCardClick?: (card: CardData, index: number) => void;
      /** Additional CSS class. */
      className?: string;
    }
    ```

    Also import `CardData` from `../../types`.

    **2. CardStack component (`src/components/CardStack/CardStack.tsx`):**

    - Uses `calculateStackLayout` from utils to get positions
    - Normalizes cards with `normalizeCard`, filters nulls
    - Renders each card in a positioned wrapper with inline transforms from layout
    - Uses `AnimatePresence` for card add/remove animations
    - Key each card with `formatCard(card)`
    - `faceUp` prop controls visibility: `true` = all face up, `false` = all face down, `'top-only'` = only last card face up (default)
    - Only top card (last in array) is clickable when `onTopCardClick` provided
    - Use `isolation: isolate` on container

    Set `CardStack.displayName = 'CardStack'`.

    **3. CardStack styles (`src/components/CardStack/CardStack.module.css`):**

    ```css
    .stack {
      position: relative;
      isolation: isolate;
      display: inline-block;
    }

    .cardSlot {
      position: absolute;
      top: 0;
      left: 0;
    }

    /* Top card has pointer cursor when clickable */
    .cardSlot--top {
      cursor: pointer;
    }
    ```

    **4. CardStack barrel (`src/components/CardStack/index.ts`):**

    Export CardStack, CardStackProps.

    **5. CardStack tests (`src/components/CardStack/CardStack.test.tsx`):**

    - Renders correct number of cards
    - Cards have diagonal offset (increasing x, y per card)
    - Top card is face-up by default with 'top-only' mode
    - All cards face-up when faceUp={true}
    - All cards face-down when faceUp={false}
    - Clicking top card fires onTopCardClick with card data
    - Handles empty cards array (renders nothing)
    - Applies custom className

    ---

    **PART B: DropZone component**

    **1. DropZone types (`src/components/DropZone/DropZone.types.ts`):**

    ```typescript
    import { ReactNode } from 'react';

    export type DropZoneEmptyState = 'none' | 'placeholder' | ReactNode;

    export interface DropZoneProps {
      /** Content to render inside the drop zone (typically cards). */
      children?: ReactNode;
      /** What to show when no children. Default: 'placeholder'. */
      emptyState?: DropZoneEmptyState;
      /** Label for the zone (displayed in placeholder). */
      label?: string;
      /** Visual state. Default: 'idle'. */
      state?: 'idle' | 'active' | 'hover';
      /** Fired when something is dropped (future: DnD integration). */
      onDrop?: () => void;
      /** Additional CSS class. */
      className?: string;
    }
    ```

    Note: `onDrop` is a placeholder for Phase 3 DnD integration. In this phase it is a simple callback prop. Per RESEARCH.md open question 4, DropZone in Phase 2 is a visual container only.

    **2. DropZone component (`src/components/DropZone/DropZone.tsx`):**

    - Renders a container div with visual state styling
    - If no children: show emptyState (placeholder with dashed border + optional label, 'none' for invisible, ReactNode for custom)
    - If children: render children inside the zone
    - `state` prop changes visual appearance: 'idle' = default, 'active' = highlighted border (blue), 'hover' = subtle highlight
    - These visual states will be driven by DnD context in Phase 3; for now they are controlled via prop

    Set `DropZone.displayName = 'DropZone'`.

    **3. DropZone styles (`src/components/DropZone/DropZone.module.css`):**

    ```css
    .dropZone {
      position: relative;
      min-width: 120px;
      min-height: 168px; /* 120 * 1.4 = poker card ratio */
      border-radius: 8px;
      transition: border-color 0.2s ease, background-color 0.2s ease;
    }

    .dropZone--idle {
      border: 2px dashed rgba(0, 0, 0, 0.15);
      background: transparent;
    }

    .dropZone--active {
      border: 2px solid #3b82f6;
      background: rgba(59, 130, 246, 0.05);
    }

    .dropZone--hover {
      border: 2px dashed #3b82f6;
      background: rgba(59, 130, 246, 0.02);
    }

    .placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      min-height: inherit;
      color: rgba(0, 0, 0, 0.3);
      font-size: 0.875rem;
    }

    .label {
      margin-top: 4px;
      font-size: 0.75rem;
    }
    ```

    **4. DropZone barrel (`src/components/DropZone/index.ts`):**

    Export DropZone, DropZoneProps, DropZoneEmptyState.

    **5. DropZone tests (`src/components/DropZone/DropZone.test.tsx`):**

    - Shows placeholder with dashed border when no children
    - Shows label text in placeholder when label prop provided
    - Renders children when provided (no placeholder)
    - Shows nothing when emptyState='none' and no children
    - Shows custom ReactNode when emptyState is JSX
    - Applies idle/active/hover visual states via class
    - Fires onDrop when clicked (simple for now)
    - Accepts className prop
  </action>
  <verify>
    `npm test -- src/components/CardStack/CardStack.test.tsx` passes.
    `npm test -- src/components/DropZone/DropZone.test.tsx` passes.
    `npx tsc --noEmit` passes.
  </verify>
  <done>
    CardStack renders overlapping cards with cascade layout and configurable face-up mode. DropZone renders visual container with idle/active/hover states and empty state options. Both components have full tests.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- all types resolve
2. `npm test -- src/components/Deck` -- Deck tests pass
3. `npm test -- src/components/CardStack` -- CardStack tests pass
4. `npm test -- src/components/DropZone` -- DropZone tests pass
5. `npm test` -- full suite passes (no regressions)
</verification>

<success_criteria>
- Deck renders visual stack of face-down cards, fires onDraw on click, handles 3 empty state modes
- Deck ref exposes drawCard() method
- CardStack renders overlapping cards with diagonal cascade offset
- CardStack supports faceUp modes: true, false, 'top-only'
- DropZone renders placeholder/empty/custom states, has idle/active/hover visual states
- All three components follow Phase 1 patterns (CSS Modules, displayName, typed props)
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/02-container-components-layouts/02-03-SUMMARY.md`
</output>
