---
phase: 02-container-components-layouts
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - src/components/index.ts
  - src/index.ts
autonomous: false

must_haves:
  truths:
    - "All Phase 2 components are importable from the library entry point"
    - "Hand, Deck, CardStack, DropZone components render correctly together"
    - "Layout utilities and useContainerSize hook are importable from library"
    - "Phase 1 exports remain intact (no regressions)"
  artifacts:
    - path: "src/components/index.ts"
      provides: "Component barrel exporting all Phase 1 + Phase 2 components"
      contains: "Hand"
    - path: "src/index.ts"
      provides: "Library entry point with all public APIs"
      contains: "useContainerSize"
  key_links:
    - from: "src/index.ts"
      to: "src/components/index.ts"
      via: "barrel re-export"
      pattern: "export.*from.*components"
    - from: "src/index.ts"
      to: "src/utils/index.ts"
      via: "barrel re-export"
      pattern: "export.*from.*utils"
    - from: "src/components/index.ts"
      to: "src/components/Hand/index.ts"
      via: "barrel re-export"
      pattern: "export.*from.*Hand"
    - from: "src/components/index.ts"
      to: "src/components/Deck/index.ts"
      via: "barrel re-export"
      pattern: "export.*from.*Deck"
    - from: "src/components/index.ts"
      to: "src/components/CardStack/index.ts"
      via: "barrel re-export"
      pattern: "export.*from.*CardStack"
    - from: "src/components/index.ts"
      to: "src/components/DropZone/index.ts"
      via: "barrel re-export"
      pattern: "export.*from.*DropZone"
---

<objective>
Update library barrel exports to include all Phase 2 components, hooks, utilities, and types. Then verify the complete Phase 2 integration with a visual checkpoint.

Purpose: Consumers of the library need to import Hand, Deck, CardStack, DropZone, layout utilities, and useContainerSize from the package entry point. This plan wires everything together and verifies the phase is complete.

Output: Updated barrel exports and verified phase integration.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-container-components-layouts/02-CONTEXT.md
@.planning/phases/02-container-components-layouts/02-01-SUMMARY.md
@.planning/phases/02-container-components-layouts/02-02-SUMMARY.md
@.planning/phases/02-container-components-layouts/02-03-SUMMARY.md
@src/index.ts
@src/components/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update barrel exports for all Phase 2 artifacts</name>
  <files>
    src/components/index.ts
    src/index.ts
  </files>
  <action>
    **1. Update components barrel (`src/components/index.ts`):**

    Currently exports only Card components. Add exports for all Phase 2 containers:

    ```typescript
    // Phase 1
    export * from './Card';

    // Phase 2
    export * from './Hand';
    export * from './Deck';
    export * from './CardStack';
    export * from './DropZone';
    ```

    **2. Update library entry point (`src/index.ts`):**

    Add Phase 2 exports. Keep all existing Phase 1 exports. Add new sections:

    ```typescript
    // @decentralized-games/card-components
    // React component library for playing cards

    // Components (Phase 1 + Phase 2)
    export { Card, CardFace, CardBack } from './components';
    export { Hand } from './components';
    export { Deck } from './components';
    export { CardStack } from './components';
    export { DropZone } from './components';
    export type {
      // Phase 1 component types
      CardProps, CardRef, CardClickData, AspectRatio, Perspective, SpringPreset,
      // Phase 2 component types
      HandProps, HandRef, HandLayout, HoverEffect,
      DeckProps, DeckRef, DeckEmptyState,
      CardStackProps,
      DropZoneProps, DropZoneEmptyState,
    } from './components';

    // Types
    export { SUITS, RANKS, parseCard, formatCard, allCards, isSuit, isRank } from './types';
    export type { Suit, Rank, CardData, CardInput, CardLayout } from './types';
    export { normalizeCard } from './types';

    // Constants
    export {
      SUIT_EMOJI, SUIT_COLORS_TWO, SUIT_COLORS_FOUR, getSuitColor,
      SPRING_PRESETS, PERSPECTIVE_VALUES, ASPECT_RATIOS,
      FAN_PRESETS, LAYOUT_DEFAULTS,
    } from './constants';
    export type {
      ColorScheme, SpringConfig, PerspectiveLevel, AspectRatioPreset,
      FanPreset,
    } from './constants';

    // Utilities (Phase 2)
    export {
      calculateFanLayout, calculateSpreadLayout, calculateStackLayout,
    } from './utils';

    // Hooks
    export { useCardFlip, usePrefersReducedMotion } from './hooks';
    export { useContainerSize } from './hooks';
    export type {
      UseCardFlipOptions, UseCardFlipReturn, SpringPresetOrCustom,
      ContainerSize,
    } from './hooks';
    ```

    Ensure no duplicate exports. Use named exports (not `export *` from components) in the library entry point to keep the public API explicit and documented.
  </action>
  <verify>
    `npx tsc --noEmit` passes.
    `npm run build` succeeds (library builds without errors).
    `npm test` passes (full test suite, no regressions).
  </verify>
  <done>
    All Phase 2 components (Hand, Deck, CardStack, DropZone), utilities (calculateFanLayout, calculateSpreadLayout, calculateStackLayout), hooks (useContainerSize), types (CardInput, CardLayout), and constants (FAN_PRESETS, LAYOUT_DEFAULTS) are importable from the library entry point. Phase 1 exports remain intact.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 2: Container Components and Layouts.

    Components built:
    - Hand: Fan/spread/stack card arrangements with controlled/uncontrolled selection, hover effects, AnimatePresence
    - Deck: Face-down card pile with draw action, empty state handling, count badge
    - CardStack: Overlapping cascade with diagonal offset, top-only face-up mode
    - DropZone: Visual container with idle/active/hover states, placeholder/custom empty states

    Supporting infrastructure:
    - Layout utilities: calculateFanLayout (arc), calculateSpreadLayout (adaptive), calculateStackLayout (cascade)
    - useContainerSize hook (ResizeObserver-based)
    - Container types (CardInput, CardLayout, normalizeCard)
    - Layout constants (FAN_PRESETS, LAYOUT_DEFAULTS)

    All exported from library entry point.
  </what-built>
  <how-to-verify>
    1. Run `npm test` - all tests should pass (Phase 1 + Phase 2, likely 150+ tests)
    2. Run `npm run build` - library should build cleanly with .d.ts output
    3. Verify exports by checking `npm run build` output includes all Phase 2 type declarations
    4. Quick code review of the container components to verify:
       - Hand renders cards in fan arrangement
       - Deck shows face-down card stack
       - CardStack shows cascade layout
       - DropZone shows placeholder state
    5. Type "approved" if everything looks correct, or describe any issues
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` -- all types resolve across the entire project
2. `npm run build` -- library builds with all new components in output
3. `npm test` -- complete test suite passes (all phases)
4. Visual review of component implementations matches CONTEXT.md decisions
</verification>

<success_criteria>
- All Phase 2 components importable from `@decentralized-games/card-components`
- Library builds successfully with type declarations
- Full test suite passes with no regressions
- Human verification confirms components are correctly implemented
</success_criteria>

<output>
After completion, create `.planning/phases/02-container-components-layouts/02-04-SUMMARY.md`
</output>
