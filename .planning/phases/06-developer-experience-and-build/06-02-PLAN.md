---
phase: 06-developer-experience-and-build
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/variables.css
  - src/components/Card/Card.module.css
  - src/components/Hand/Hand.module.css
  - src/components/Deck/Deck.module.css
  - src/components/CardStack/CardStack.module.css
  - src/components/DropZone/DropZone.module.css
  - src/components/DraggableCard/DraggableCard.module.css
  - src/components/CardDragOverlay/CardDragOverlay.module.css
  - src/hooks/useDraggableCard.ts
  - src/hooks/useDroppableZone.ts
  - src/hooks/index.ts
  - src/index.ts
autonomous: true

must_haves:
  truths:
    - "Consumer can override card colors, borders, shadows by setting CSS custom properties"
    - "useDraggableCard hook returns drag state without requiring DraggableCard component"
    - "useDroppableZone hook returns drop state without requiring DroppableZone component"
    - "All visual tokens use CSS custom properties with sensible defaults"
  artifacts:
    - path: "src/styles/variables.css"
      provides: "Global CSS custom property token definitions"
      contains: "--card-bg"
    - path: "src/hooks/useDraggableCard.ts"
      provides: "Headless drag hook wrapping dnd-kit useDraggable"
      exports: ["useDraggableCard"]
    - path: "src/hooks/useDroppableZone.ts"
      provides: "Headless drop zone hook wrapping dnd-kit useDroppable"
      exports: ["useDroppableZone"]
  key_links:
    - from: "src/styles/variables.css"
      to: "src/components/*//*.module.css"
      via: "CSS custom property inheritance"
      pattern: "var\\(--"
    - from: "src/hooks/useDraggableCard.ts"
      to: "@dnd-kit/core"
      via: "useDraggable import"
      pattern: "useDraggable"
---

<objective>
Create a CSS custom property theming system and headless DnD hooks for consumers who want low-level control.

Purpose: CSS variables (DX-03) let consumers customize card appearance without CSS overrides. Headless hooks (DX-02) let advanced consumers build custom card UIs using the library's DnD logic without the opinionated components.
Output: src/styles/variables.css, refactored component CSS, useDraggableCard and useDroppableZone hooks.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-developer-experience-and-build/06-RESEARCH.md
@src/components/Card/Card.module.css
@src/components/Hand/Hand.module.css
@src/components/Deck/Deck.module.css
@src/components/CardStack/CardStack.module.css
@src/components/DropZone/DropZone.module.css
@src/components/DraggableCard/DraggableCard.module.css
@src/components/CardDragOverlay/CardDragOverlay.module.css
@src/hooks/index.ts
@src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CSS variable theming system and refactor component styles</name>
  <files>src/styles/variables.css, src/components/Card/Card.module.css, src/components/Hand/Hand.module.css, src/components/Deck/Deck.module.css, src/components/CardStack/CardStack.module.css, src/components/DropZone/DropZone.module.css, src/components/DraggableCard/DraggableCard.module.css, src/components/CardDragOverlay/CardDragOverlay.module.css</files>
  <action>
Create `src/styles/variables.css` with `:root` block defining all theme tokens. Reference 06-RESEARCH.md Pattern 2 for the full list. Key tokens:

```css
:root {
  /* Card tokens */
  --card-bg: #ffffff;
  --card-back-bg: linear-gradient(135deg, #1a365d 0%, #2d4a7c 100%);
  --card-border-radius: 8px;
  --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  --card-shadow-hover: 0 4px 8px rgba(0, 0, 0, 0.3);
  --card-perspective: 1000px;
  --card-padding: 0.5em;

  /* Suit colors */
  --suit-red: #cc0000;
  --suit-black: #000000;

  /* Container tokens */
  --deck-badge-bg: #1a365d;
  --deck-badge-color: white;
  --empty-border-color: rgba(0, 0, 0, 0.15);
  --dropzone-active-border: rgba(59, 130, 246, 0.5);

  /* Focus/selection tokens */
  --focus-ring-offset: 2px;
  --selected-shadow: 0 0 0 3px rgba(34, 197, 94, 0.6);
}
```

Then refactor each component CSS module to use `var(--token-name)` instead of hardcoded values. Focus on values consumers would realistically want to customize:
- Card.module.css: background, border-radius, shadow, perspective, padding, back pattern
- Hand.module.css: any card spacing/gap tokens
- Deck.module.css: badge colors, empty state border
- CardStack.module.css: any visual tokens
- DropZone.module.css: border colors, active state colors
- DraggableCard.module.css: drag state visual feedback
- CardDragOverlay.module.css: overlay shadow/opacity

**IMPORTANT:** Card.module.css already has some CSS custom properties (`--card-perspective`, `--card-border-radius`, `--card-padding`, `--card-shadow`, `--card-shadow-hover`). Preserve those and add the new ones from variables.css as defaults. The component-level properties override the global defaults.

After refactoring, run `npm test` to ensure no visual regressions break existing tests.
  </action>
  <verify>Run `npm test` - all 435+ tests pass. Inspect the CSS modules to confirm they reference `var(--*)` tokens. Verify `src/styles/variables.css` exists with all tokens.</verify>
  <done>All component CSS modules use CSS custom properties for customizable values. A central variables.css file defines all token defaults.</done>
</task>

<task type="auto">
  <name>Task 2: Create headless useDraggableCard and useDroppableZone hooks</name>
  <files>src/hooks/useDraggableCard.ts, src/hooks/useDroppableZone.ts, src/hooks/index.ts, src/index.ts</files>
  <action>
Create `src/hooks/useDraggableCard.ts`:
- Import `useDraggable` from `@dnd-kit/core`
- Import `DragItemData` from `../types`
- Define `UseDraggableCardOptions` interface: `{ id: string; card: CardData; sourceZoneId?: string; disabled?: boolean }`
- Define `UseDraggableCardReturn` interface: `{ ref: (node: HTMLElement | null) => void; dragAttributes: Record<string, unknown>; dragListeners: Record<string, unknown> | undefined; transform: { x: number; y: number } | null; isDragging: boolean }`
- Hook wraps `useDraggable` with `data: { type: 'card', card, sourceZoneId } satisfies DragItemData`
- Return `{ ref: setNodeRef, dragAttributes: attributes, dragListeners: listeners, transform, isDragging }`

Create `src/hooks/useDroppableZone.ts`:
- Import `useDroppable` from `@dnd-kit/core`
- Import `DropValidationFn` from `../types`
- Define `UseDroppableZoneOptions` interface: `{ id: string; accepts?: string[]; onValidate?: DropValidationFn; disabled?: boolean }`
- Define `UseDroppableZoneReturn` interface: `{ ref: (node: HTMLElement | null) => void; isOver: boolean; active: Active | null }`
- Hook wraps `useDroppable` with `data: { accepts, onValidate }` for validation
- Return `{ ref: setNodeRef, isOver, active }`

Add both hooks to `src/hooks/index.ts` barrel.

Add both hooks + their option/return types to `src/index.ts` barrel exports.

Reference 06-RESEARCH.md headless hook pattern for the DraggableCard example. These are thin wrappers that let consumers use the library's DnD data protocols without the opinionated component wrappers.
  </action>
  <verify>Run `npm test` - all tests pass. Verify hooks are exported from `src/index.ts`. Check TypeScript compilation with `npx tsc --noEmit`.</verify>
  <done>useDraggableCard and useDroppableZone are exported as headless hooks. TypeScript types are correct. Existing tests unaffected.</done>
</task>

</tasks>

<verification>
1. `src/styles/variables.css` defines all theme tokens as CSS custom properties
2. Component CSS modules reference `var(--*)` for customizable values
3. `useDraggableCard` and `useDroppableZone` hooks are exported from barrel
4. `npm test` passes with no regressions
5. `npx tsc --noEmit` succeeds
</verification>

<success_criteria>
- CSS custom properties system allows consumers to override card appearance by setting variables on a parent element
- Headless hooks expose DnD functionality without requiring opinionated component wrappers
- All existing tests pass without regression
</success_criteria>

<output>
After completion, create `.planning/phases/06-developer-experience-and-build/06-02-SUMMARY.md`
</output>
