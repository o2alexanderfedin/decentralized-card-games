---
phase: 06-developer-experience-and-build
plan: 05
type: execute
wave: 3
depends_on: ["06-03", "06-04"]
files_modified:
  - src/components/DraggableCard/DraggableCard.stories.tsx
  - src/components/CardDndProvider/CardDndProvider.stories.tsx
  - src/components/StatefulCardDndProvider/StatefulCardDndProvider.stories.tsx
  - .storybook/preview.ts
autonomous: true

must_haves:
  truths:
    - "Storybook shows interactive drag-and-drop stories where cards can be dragged between zones"
    - "A complete game-like demo (e.g., deal and move cards) is shown in Storybook"
    - "Full build pipeline works end-to-end: lint, test with coverage, build, size check"
    - "All npm scripts work correctly: lint, test, test:coverage, build, size, storybook"
  artifacts:
    - path: "src/components/DraggableCard/DraggableCard.stories.tsx"
      provides: "DnD interactive stories"
      contains: "meta"
    - path: "src/components/CardDndProvider/CardDndProvider.stories.tsx"
      provides: "Complete DnD context stories with drag-and-drop between zones"
      contains: "CardDndProvider"
  key_links:
    - from: "src/components/CardDndProvider/CardDndProvider.stories.tsx"
      to: "src/components/CardDndProvider/CardDndProvider.tsx"
      via: "Component import"
      pattern: "CardDndProvider"
    - from: "package.json"
      to: "dist/"
      via: "build + size scripts"
      pattern: "build.*size"
---

<objective>
Create advanced Storybook stories with interactive DnD demos and game-like examples, then verify the complete build pipeline works end-to-end.

Purpose: Complete the DX-01 Storybook requirement with Interactions and Games categories (per CONTEXT), and validate that all Phase 6 build infrastructure works together: lint, test with coverage, build with ESM+UMD, and bundle size monitoring.
Output: Interactive DnD stories, game demo stories, verified build pipeline.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-developer-experience-and-build/06-RESEARCH.md
@.planning/phases/06-developer-experience-and-build/06-CONTEXT.md
@.planning/phases/06-developer-experience-and-build/06-03-SUMMARY.md
@.planning/phases/06-developer-experience-and-build/06-04-SUMMARY.md
@src/components/DraggableCard/DraggableCard.tsx
@src/components/CardDndProvider/CardDndProvider.tsx
@src/components/DroppableZone/DroppableZone.tsx
@src/components/CardDragOverlay/CardDragOverlay.tsx
@src/components/StatefulCardDndProvider/StatefulCardDndProvider.tsx
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create interactive DnD and game demo stories</name>
  <files>src/components/DraggableCard/DraggableCard.stories.tsx, src/components/CardDndProvider/CardDndProvider.stories.tsx, src/components/StatefulCardDndProvider/StatefulCardDndProvider.stories.tsx</files>
  <action>
Create stories for DnD components following the CONTEXT-specified use-case categories: Interactions and Games.

**DraggableCard stories** (`src/components/DraggableCard/DraggableCard.stories.tsx`):
- title: `'Interactions/DraggableCard'`
- Stories: `BasicDrag` (single draggable card), `DisabledDrag` (non-draggable), `WithDragOverlay`
- These stories need a DnD context wrapper. Create a simple decorator that wraps with `CardDndProvider`:
  ```typescript
  decorators: [(Story) => (
    <CardDndProvider>
      <Story />
    </CardDndProvider>
  )]
  ```

**CardDndProvider stories** (`src/components/CardDndProvider/CardDndProvider.stories.tsx`):
- title: `'Interactions/Drag and Drop'`
- Stories:
  - `DragBetweenZones`: Two DroppableZones with cards, user can drag cards between them. Use state to track card positions.
  - `DragWithValidation`: DroppableZone that only accepts certain suits/ranks
  - `MultipleCards`: Several draggable cards with drop zones

For the DragBetweenZones story, create a small wrapper component that manages card state internally using React useState:
```typescript
const DragBetweenZonesDemo = () => {
  const [zone1Cards, setZone1Cards] = useState([parseCard('A♠'), parseCard('K♥'), parseCard('Q♦')]);
  const [zone2Cards, setZone2Cards] = useState<CardData[]>([]);
  // ... handle drag end to move cards between zones
  return (
    <CardDndProvider onDragEnd={handleDragEnd}>
      <div style={{ display: 'flex', gap: '2rem' }}>
        <DroppableZone id="zone1">
          {zone1Cards.map(card => <DraggableCard key={formatCard(card)} card={card} ... />)}
        </DroppableZone>
        <DroppableZone id="zone2">
          {zone2Cards.map(card => <DraggableCard key={formatCard(card)} card={card} ... />)}
        </DroppableZone>
      </div>
      <CardDragOverlay />
    </CardDndProvider>
  );
};
```

**StatefulCardDndProvider stories** (`src/components/StatefulCardDndProvider/StatefulCardDndProvider.stories.tsx`):
- title: `'Games/Card Table'`
- Stories:
  - `DealAndMove`: A game-like demo with a Deck, a Hand, and a DropZone. Click deck to deal, drag cards to drop zone. Uses GameProvider + StatefulCardDndProvider for full state integration.
  - This is the showpiece story demonstrating the library's full capabilities.

For the DealAndMove story, wrap with `<GameProvider>` and `<StatefulCardDndProvider>`, use `useGameActions()` for dealing, and `useLocation()` for displaying cards in each zone.

All stories should import components directly from their source files (not barrel) for Storybook component inference.
  </action>
  <verify>Run `npm run storybook` - navigate to Interactions/ and Games/ sections. Verify drag-and-drop works in the DragBetweenZones story. Verify the DealAndMove game demo functions correctly.</verify>
  <done>Interactive DnD stories show drag between zones. Game demo shows deal-and-move flow. All stories render and function correctly in Storybook.</done>
</task>

<task type="auto">
  <name>Task 2: Verify complete build pipeline end-to-end</name>
  <files></files>
  <action>
Run the complete build pipeline to verify all Phase 6 infrastructure works together:

1. **Lint check:**
   ```bash
   npm run lint
   ```
   Fix any lint errors in story files (unused imports, a11y issues, etc.). Stories may need `// eslint-disable` for specific patterns that are intentional in demo code.

2. **Type check:**
   ```bash
   npm run typecheck
   ```

3. **Test with coverage:**
   ```bash
   npm run test:coverage
   ```
   Verify >80% coverage thresholds pass. If coverage is below threshold on any metric, identify which files need more tests and note in summary (but don't block on this - coverage may require a gap closure plan).

4. **Build:**
   ```bash
   npm run build
   ```
   Verify output includes:
   - `dist/card-components.js` (ESM)
   - `dist/card-components.umd.cjs` (UMD)
   - `dist/card-components-redux.js` (ESM)
   - `dist/index.d.ts` and `dist/redux/index.d.ts` (.d.ts files)
   - `dist/style.css` or similar (CSS)
   - Source map files (`.map`)

5. **Bundle size check:**
   ```bash
   npm run size
   ```
   Verify bundles are within configured limits.

6. **Storybook build (static):**
   ```bash
   npm run build-storybook
   ```
   Verify it produces `storybook-static/` directory.

If any step fails, fix the issue. Document any lint warnings that are acceptable (e.g., unused vars in story demos).

Ensure `.gitignore` includes `storybook-static/` and `coverage/`.
  </action>
  <verify>All six commands run successfully: lint, typecheck, test:coverage, build, size, build-storybook. No blocking errors.</verify>
  <done>Complete build pipeline verified: lint passes (or has only acceptable warnings), tests pass with >80% coverage, build produces ESM+UMD+CSS+sourcemaps+types, bundle size within budget, and Storybook builds to static output.</done>
</task>

</tasks>

<verification>
1. Storybook shows four categories: Getting Started, Layouts, Interactions, Games
2. DragBetweenZones story allows interactive drag-and-drop
3. DealAndMove game demo shows full state management + DnD integration
4. `npm run lint` passes (or has only acceptable warnings)
5. `npm run test:coverage` shows >80% on all metrics
6. `npm run build` produces correct dist/ artifacts
7. `npm run size` confirms bundles within budget
8. `npm run build-storybook` produces storybook-static/
</verification>

<success_criteria>
- Storybook has interactive DnD stories and a game-like demo
- All Phase 6 build tools work end-to-end (lint, coverage, build, size, storybook)
- The library is ready for npm distribution with correct build artifacts
- Developer experience matches the CONTEXT vision: use-case organized interactive documentation
</success_criteria>

<output>
After completion, create `.planning/phases/06-developer-experience-and-build/06-05-SUMMARY.md`
</output>
