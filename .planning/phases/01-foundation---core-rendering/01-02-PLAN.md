---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/hooks/useCardFlip.ts
  - src/hooks/usePrefersReducedMotion.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "useCardFlip returns motion values that animate without React re-renders"
    - "usePrefersReducedMotion detects system motion preference"
    - "Spring animation creates bouncy flip effect"
  artifacts:
    - path: "src/hooks/useCardFlip.ts"
      provides: "Flip animation state management"
      exports: ["useCardFlip"]
      min_lines: 40
    - path: "src/hooks/usePrefersReducedMotion.ts"
      provides: "Accessibility motion detection"
      exports: ["usePrefersReducedMotion"]
      min_lines: 15
    - path: "src/hooks/index.ts"
      provides: "Barrel exports for hooks"
      exports: ["useCardFlip", "usePrefersReducedMotion"]
  key_links:
    - from: "src/hooks/useCardFlip.ts"
      to: "motion"
      via: "useSpring import"
      pattern: "import.*useSpring.*from.*motion"
    - from: "src/hooks/useCardFlip.ts"
      to: "src/constants/animations.ts"
      via: "SPRING_PRESETS import"
      pattern: "import.*SPRING_PRESETS"
---

<objective>
Create animation hooks for card flip using Motion's useMotionValue pattern.

Purpose: Encapsulate flip animation logic in reusable hooks that prevent React re-renders during animation. This is critical for performance (ANIM-02, ANIM-04 requirements).

Output:
- useCardFlip hook with motion values for rotation, opacity
- usePrefersReducedMotion hook for accessibility
- Hooks ready for consumption by Card component in Plan 04
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-foundation---core-rendering/01-CONTEXT.md
@.planning/phases/01-foundation---core-rendering/01-RESEARCH.md
@.planning/phases/01-foundation---core-rendering/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCardFlip hook with motion values</name>
  <files>src/hooks/useCardFlip.ts</files>
  <action>
Create the flip animation hook in src/hooks/useCardFlip.ts:

```typescript
import { useSpring, useTransform, MotionValue } from 'motion/react';
import { useEffect } from 'react';
import { SPRING_PRESETS } from '../constants';

export interface UseCardFlipOptions {
  /** Current face-up state */
  isFaceUp: boolean;
  /** Spring configuration preset or custom values */
  spring?: 'default' | 'bouncy' | 'stiff' | { stiffness: number; damping: number };
  /** Callback when flip animation completes */
  onFlipComplete?: () => void;
}

export interface UseCardFlipReturn {
  /** Y-axis rotation in degrees (0 = face up, 180 = face down) */
  rotateY: MotionValue<number>;
  /** Front face opacity (1 when visible, 0 when hidden) */
  frontOpacity: MotionValue<number>;
  /** Back face opacity (0 when hidden, 1 when visible) */
  backOpacity: MotionValue<number>;
  /** Whether flip animation is currently running */
  isAnimating: boolean;
}
```

Implementation requirements:
1. Use `useSpring` for rotateY motion value (NOT useState)
   - Target rotation: isFaceUp ? 0 : 180
   - Apply spring config from preset or custom values

2. Use `useTransform` to derive opacity values from rotateY:
   - frontOpacity: [0, 89, 90, 180] -> [1, 1, 0, 0]
   - backOpacity: [0, 89, 90, 180] -> [0, 0, 1, 1]

3. Track animation state using `useEffect` with rotateY.on('change') subscriber

4. Call onFlipComplete when animation settles

CRITICAL: Do NOT use React state for rotation values. This would cause 60+ re-renders per second. Use motion values exclusively.

Reference: RESEARCH.md "Pattern 2: Motion Values for Animation State"
  </action>
  <verify>
Test the hook behavior:
- rotateY.get() returns 0 when isFaceUp=true
- rotateY.get() returns 180 when isFaceUp=false
- frontOpacity derives correctly from rotateY
- No React re-renders during animation (check with React DevTools)
  </verify>
  <done>
- useCardFlip is exported with correct TypeScript types
- Motion values update without triggering re-renders
- Spring animation provides bouncy feel
- onFlipComplete callback fires after animation settles
  </done>
</task>

<task type="auto">
  <name>Task 2: Create usePrefersReducedMotion hook</name>
  <files>src/hooks/usePrefersReducedMotion.ts</files>
  <action>
Create accessibility hook in src/hooks/usePrefersReducedMotion.ts:

```typescript
import { useState, useEffect } from 'react';

const QUERY = '(prefers-reduced-motion: reduce)';

/**
 * Hook to detect user's motion preference from system settings.
 * Returns true if user prefers reduced motion.
 */
export function usePrefersReducedMotion(): boolean {
  // Implementation...
}
```

Implementation requirements:
1. Initial state from matchMedia query (handle SSR with false default)
2. Subscribe to changes with addEventListener('change')
3. Cleanup subscription on unmount
4. Handle SSR case where window is undefined

Reference: RESEARCH.md "Prefers Reduced Motion Hook" code example from Josh W. Comeau

This hook enables consumers to disable or simplify animations for users with vestibular disorders (A11Y-06 requirement preview, but needed now for Card component).
  </action>
  <verify>
- Hook returns boolean
- Updates when system preference changes
- No errors during SSR (window undefined)
- Cleans up event listener on unmount
  </verify>
  <done>
- usePrefersReducedMotion exported
- Returns true when system prefers reduced motion
- Reactive to system preference changes
- SSR-safe implementation
  </done>
</task>

<task type="auto">
  <name>Task 3: Create hooks barrel export</name>
  <files>src/hooks/index.ts</files>
  <action>
Create barrel export in src/hooks/index.ts:

```typescript
export { useCardFlip } from './useCardFlip';
export type { UseCardFlipOptions, UseCardFlipReturn } from './useCardFlip';
export { usePrefersReducedMotion } from './usePrefersReducedMotion';
```

Ensure all public types are re-exported for TypeScript consumers.
  </action>
  <verify>
- Import { useCardFlip, usePrefersReducedMotion } from './hooks' works
- TypeScript types are accessible
  </verify>
  <done>
- All hooks exported from single entry point
- Types exported for TypeScript consumers
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Hooks structure exists:
   ```
   src/hooks/
     useCardFlip.ts
     usePrefersReducedMotion.ts
     index.ts
   ```

2. TypeScript compiles: `npx tsc --noEmit`

3. Hook behavior (manual verification in test component):
   - useCardFlip animates rotation smoothly
   - Opacity transitions at 90 degrees
   - usePrefersReducedMotion responds to system settings
</verification>

<success_criteria>
- useCardFlip uses motion values (not React state) for animation
- Spring physics create bouncy, playful flip animation
- usePrefersReducedMotion detects system accessibility preference
- Hooks are ready for Card component integration
- Zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation---core-rendering/01-02-SUMMARY.md`
</output>
