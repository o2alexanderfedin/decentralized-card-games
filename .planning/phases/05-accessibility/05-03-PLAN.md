---
phase: 05-accessibility
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/Card/Card.tsx
  - src/components/Hand/Hand.tsx
  - src/components/Hand/Hand.types.ts
  - src/components/Deck/Deck.tsx
  - src/components/CardStack/CardStack.tsx
  - src/components/DropZone/DropZone.tsx
  - src/components/DroppableZone/DroppableZone.tsx
autonomous: true

must_haves:
  truths:
    - "Card aria-label uses natural language (e.g. 'Ace of Spades') via formatCardForSpeech"
    - "Face-down Card announces as 'Face-down card' without revealing identity"
    - "Hand container has role='listbox' and aria-label"
    - "Cards within Hand have role='option' and aria-selected"
    - "Arrow keys navigate between cards in Hand without Tab-trapping"
    - "Space/Enter on a focused card in Hand toggles selection"
    - "Deck responds to Enter/Space keypress for draw action"
    - "CardStack has role='group' with descriptive aria-label"
    - "DropZone has role='region' and aria-label"
    - "DroppableZone passes aria-label to wrapped DropZone"
  artifacts:
    - path: "src/components/Card/Card.tsx"
      provides: "Enhanced ARIA label using formatCardForSpeech, face-down protection"
      contains: "formatCardForSpeech"
    - path: "src/components/Hand/Hand.tsx"
      provides: "Listbox role, roving tabindex, keyboard selection"
      contains: "useRovingTabIndex"
    - path: "src/components/Deck/Deck.tsx"
      provides: "Keyboard Enter/Space for draw action"
      contains: "onKeyDown"
    - path: "src/components/CardStack/CardStack.tsx"
      provides: "Group role with descriptive aria-label"
      contains: "role=\"group\""
    - path: "src/components/DropZone/DropZone.tsx"
      provides: "Region role with aria-label"
      contains: "role=\"region\""
  key_links:
    - from: "src/components/Card/Card.tsx"
      to: "src/utils/a11y.ts"
      via: "formatCardForSpeech import"
      pattern: "import.*formatCardForSpeech.*from"
    - from: "src/components/Hand/Hand.tsx"
      to: "src/hooks/useRovingTabIndex.ts"
      via: "useRovingTabIndex hook integration"
      pattern: "useRovingTabIndex"
    - from: "src/components/Hand/Hand.tsx"
      to: "src/utils/a11y.ts"
      via: "formatCardLabel for position-aware labels"
      pattern: "formatCardLabel"
---

<objective>
Add ARIA roles, labels, and keyboard navigation to all card components so screen readers announce card identity and keyboard users can navigate without mouse.

Purpose: This is the core accessibility work -- transforming visual-only components into WCAG-compliant interactive widgets. Covers A11Y-01 (semantic HTML), A11Y-02 (keyboard navigation), A11Y-03 (ARIA labels/roles), A11Y-04 (focus management), A11Y-07 (touch targets via CSS already in Plan 02).
Output: All 6 components enhanced with proper ARIA attributes and keyboard interaction patterns.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-accessibility/05-CONTEXT.md
@.planning/phases/05-accessibility/05-RESEARCH.md
@.planning/phases/05-accessibility/05-01-SUMMARY.md
@src/components/Card/Card.tsx
@src/components/Hand/Hand.tsx
@src/components/Deck/Deck.tsx
@src/components/CardStack/CardStack.tsx
@src/components/DropZone/DropZone.tsx
@src/components/DroppableZone/DroppableZone.tsx
@src/utils/a11y.ts
@src/hooks/useRovingTabIndex.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Card, Deck, CardStack, DropZone, and DroppableZone ARIA enhancements</name>
  <files>src/components/Card/Card.tsx, src/components/Deck/Deck.tsx, src/components/CardStack/CardStack.tsx, src/components/DropZone/DropZone.tsx, src/components/DroppableZone/DroppableZone.tsx</files>
  <action>
**Card.tsx:**
1. Import `formatCardForSpeech` from `../../utils/a11y`
2. Replace the existing `ariaLabel` useMemo with:
   - If `!faceUp`: return `'Face-down card'` (CRITICAL: never reveal identity)
   - If `!cardData`: return `'Card'`
   - Otherwise: return `formatCardForSpeech(cardData)` (e.g., "Ace of Spades")
3. Keep existing `role="button"`, `tabIndex={0}`, and the `aria-label={ariaLabel}` binding
4. Add `onKeyDown` handler to the `motion.div` that triggers `handleClick` on Enter or Space:
   ```typescript
   onKeyDown={(e: React.KeyboardEvent) => {
     if (e.key === 'Enter' || e.key === ' ') {
       e.preventDefault();
       handleClick();
     }
   }}
   ```

**Deck.tsx:**
1. Add `onKeyDown` handler to the main div (the one with `role="button"`) that triggers `handleDraw` on Enter or Space:
   ```typescript
   onKeyDown={(e: React.KeyboardEvent) => {
     if (e.key === 'Enter' || e.key === ' ') {
       e.preventDefault();
       handleDraw();
     }
   }}
   ```
2. The existing `aria-label={`Deck with ${count} card${count === 1 ? '' : 's'}`}` is good -- keep it.
3. Add `aria-label="Empty deck"` to the empty state divs (when count <= 0).

**CardStack.tsx:**
1. Add `role="group"` to the container div
2. Add `aria-label` prop to CardStackProps (in CardStack.types.ts) if not present, defaulting to "Card stack"
3. Use: `aria-label={ariaLabel ?? \`Card stack, ${normalizedCards.length} card${normalizedCards.length === 1 ? '' : 's'}\`}`

**DropZone.tsx:**
1. Add `role="region"` to the container div
2. Add `aria-label` using the existing `label` prop: `aria-label={label ?? 'Drop zone'}`

**DroppableZone.tsx:**
1. Pass `aria-label` to the wrapper div: `aria-label={label ?? 'Drop zone'}`
2. Add `role="region"` to the wrapper div
  </action>
  <verify>Run `npx vitest run src/components/Card/ src/components/Deck/ src/components/CardStack/ src/components/DropZone/ src/components/DroppableZone/` -- existing tests pass. Run `npx tsc --noEmit` -- no type errors.</verify>
  <done>Card uses natural language ARIA labels and protects face-down identity. Deck, CardStack, DropZone, DroppableZone all have proper ARIA roles and labels. All interactive elements respond to Enter/Space keyboard activation.</done>
</task>

<task type="auto">
  <name>Task 2: Hand component with listbox role and roving tabindex</name>
  <files>src/components/Hand/Hand.tsx, src/components/Hand/Hand.types.ts</files>
  <action>
This is the most complex ARIA enhancement. The Hand component renders multiple cards in a fan/spread/stack layout. Currently each card has no tab stop and no keyboard navigation within the container.

**Hand.types.ts:**
1. Add optional `ariaLabel?: string` prop to HandProps (default: "Your hand")

**Hand.tsx:**
1. Import `useRovingTabIndex` from `../../hooks`
2. Import `formatCardForSpeech`, `formatCardLabel`, `formatFaceDownLabel` from `../../utils/a11y`
3. Add `ariaLabel = 'Your hand'` to destructured props

4. Initialize roving tabindex:
   ```typescript
   const { activeIndex, setActiveIndex, getTabIndex, handleKeyDown: handleRovingKeyDown } = useRovingTabIndex(normalizedCards.length);
   ```

5. Add refs array for card slots to manage focus:
   ```typescript
   const cardRefs = useRef<(HTMLDivElement | null)[]>([]);
   ```

6. Add useEffect to focus the active card slot when activeIndex changes:
   ```typescript
   useEffect(() => {
     cardRefs.current[activeIndex]?.focus();
   }, [activeIndex]);
   ```

7. Add ARIA attributes to the container div:
   ```typescript
   role="listbox"
   aria-label={ariaLabel}
   aria-orientation="horizontal"
   ```

8. Modify each `motion.div` card slot:
   - Add `ref` callback: `ref={(el) => { cardRefs.current[i] = el; }}`
   - Add `role="option"`
   - Add `aria-selected={isSelected}`
   - Add `aria-label` using:
     - If faceUp: `formatCardLabel(card, i + 1, normalizedCards.length, ariaLabel)`
     - If !faceUp: `formatFaceDownLabel(i + 1, normalizedCards.length, ariaLabel)`
   - Add `tabIndex={getTabIndex(i)}`
   - Add `onKeyDown` handler:
     ```typescript
     onKeyDown={(e: React.KeyboardEvent<HTMLDivElement>) => {
       handleRovingKeyDown(e, i);
       if (e.key === ' ' || e.key === 'Enter') {
         e.preventDefault();
         handleCardClick(card, i);
       }
     }}
     ```

9. Preserve all existing motion props (layout, initial, animate, exit, transition, style, onClick).

IMPORTANT: The onClick handler remains for mouse users. The onKeyDown handler with Space/Enter provides equivalent keyboard activation. Both call handleCardClick.

Do NOT add tabIndex={0} to every card -- that would create a tab-trap. The roving tabindex pattern means only ONE card in the hand has tabIndex={0} at a time; the rest have tabIndex={-1}. Users Tab to the hand, then Arrow within it.
  </action>
  <verify>Run `npx vitest run src/components/Hand/` -- existing tests pass. Run `npx tsc --noEmit` -- no type errors.</verify>
  <done>Hand has role="listbox" with card slots as role="option". Roving tabindex provides arrow key navigation. Space/Enter toggles selection. Screen readers announce "Ace of Spades, card 3 of 7 in Your hand".</done>
</task>

</tasks>

<verification>
Run `npx vitest run` -- all tests pass.
Run `npx tsc --noEmit` -- no TypeScript errors.
Grep for `role=` in all modified components confirms ARIA roles present.
Grep for `formatCardForSpeech` confirms a11y utilities are wired.
</verification>

<success_criteria>
- Card ARIA label says "Ace of Spades" (not "A of spades") for face-up cards
- Face-down cards announce as "Face-down card" -- identity is never leaked
- Hand is a single Tab stop with Arrow key navigation between cards
- Space/Enter on a card in Hand toggles its selection
- Deck responds to Enter/Space for draw action
- CardStack has role="group" with card count in label
- DropZone and DroppableZone have role="region" with descriptive labels
- All existing tests continue to pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-accessibility/05-03-SUMMARY.md`
</output>
