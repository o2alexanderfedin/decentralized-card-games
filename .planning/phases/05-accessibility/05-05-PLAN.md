---
phase: 05-accessibility
plan: 05
type: execute
wave: 3
depends_on: ["05-02", "05-03", "05-04"]
files_modified:
  - src/components/Card/Card.test.tsx
  - src/components/Hand/Hand.test.tsx
  - src/components/Deck/Deck.test.tsx
  - src/components/CardStack/CardStack.test.tsx
  - src/components/DropZone/DropZone.test.tsx
  - src/components/DraggableCard/DraggableCard.test.tsx
  - src/index.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "axe accessibility scans pass with no violations for Card, Hand, Deck, CardStack, DropZone"
    - "Card test verifies face-down aria-label is 'Face-down card'"
    - "Hand test verifies role='listbox' and role='option' on children"
    - "Hand test verifies arrow key navigation changes focused card"
    - "Deck test verifies Enter key triggers draw"
    - "All new hooks and utilities are exported from src/index.ts"
    - "All existing tests continue to pass"
  artifacts:
    - path: "src/components/Card/Card.test.tsx"
      provides: "Axe scan + face-down label + keyboard activation tests"
      contains: "toHaveNoViolations"
    - path: "src/components/Hand/Hand.test.tsx"
      provides: "Axe scan + listbox role + roving tabindex + keyboard selection tests"
      contains: "toHaveNoViolations"
    - path: "src/components/Deck/Deck.test.tsx"
      provides: "Axe scan + keyboard draw tests"
      contains: "toHaveNoViolations"
    - path: "src/index.ts"
      provides: "Barrel exports for all Phase 5 additions"
      contains: "useRovingTabIndex"
  key_links:
    - from: "src/components/Card/Card.test.tsx"
      to: "vitest-axe"
      via: "axe() + toHaveNoViolations()"
      pattern: "axe.*toHaveNoViolations"
    - from: "src/index.ts"
      to: "src/hooks/index.ts"
      via: "re-exports Phase 5 hooks"
      pattern: "useRovingTabIndex|useKeyboardShortcuts"
---

<objective>
Add vitest-axe accessibility tests to all components, test keyboard interactions, and update barrel exports to include all Phase 5 additions.

Purpose: Validates that all accessibility enhancements work correctly via automated axe-core scans and keyboard interaction tests. Updates barrel exports so consumers can import the new hooks and utilities. Covers final integration verification for A11Y-01 through A11Y-08.
Output: Every component has axe scan test. Keyboard interactions are tested. All Phase 5 exports are public.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-accessibility/05-CONTEXT.md
@.planning/phases/05-accessibility/05-01-SUMMARY.md
@.planning/phases/05-accessibility/05-02-SUMMARY.md
@.planning/phases/05-accessibility/05-03-SUMMARY.md
@.planning/phases/05-accessibility/05-04-SUMMARY.md
@src/components/Card/Card.test.tsx
@src/components/Hand/Hand.test.tsx
@src/components/Deck/Deck.test.tsx
@src/index.ts
@src/hooks/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Accessibility tests for all components</name>
  <files>src/components/Card/Card.test.tsx, src/components/Hand/Hand.test.tsx, src/components/Deck/Deck.test.tsx, src/components/CardStack/CardStack.test.tsx, src/components/DropZone/DropZone.test.tsx, src/components/DraggableCard/DraggableCard.test.tsx</files>
  <action>
Add accessibility test sections to each existing test file. Import `axe` from `vitest-axe` in each file. If the import shape doesn't match, try `import { axe } from 'vitest-axe'`.

**Card.test.tsx -- add these tests:**
```typescript
describe('accessibility', () => {
  it('has no axe violations when face up', async () => {
    const { container } = render(<Card card="sA" isFaceUp={true} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('has no axe violations when face down', async () => {
    const { container } = render(<Card card="sA" isFaceUp={false} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('announces card identity when face up', () => {
    render(<Card card="sA" isFaceUp={true} />);
    expect(screen.getByRole('button')).toHaveAttribute('aria-label', 'Ace of Spades');
  });

  it('announces "Face-down card" when face down', () => {
    render(<Card card="sA" isFaceUp={false} />);
    expect(screen.getByRole('button')).toHaveAttribute('aria-label', 'Face-down card');
  });

  it('activates on Enter key', async () => {
    const onClick = vi.fn();
    render(<Card card="sA" isFaceUp={true} onClick={onClick} />);
    const card = screen.getByRole('button');
    await userEvent.type(card, '{Enter}');
    expect(onClick).toHaveBeenCalled();
  });

  it('activates on Space key', async () => {
    const onClick = vi.fn();
    render(<Card card="sA" isFaceUp={true} onClick={onClick} />);
    const card = screen.getByRole('button');
    await userEvent.type(card, ' ');
    expect(onClick).toHaveBeenCalled();
  });
});
```

**Hand.test.tsx -- add these tests:**
```typescript
describe('accessibility', () => {
  it('has no axe violations', async () => {
    const { container } = render(<Hand cards={['sA', 'h7', 'dK']} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('has listbox role', () => {
    render(<Hand cards={['sA', 'h7']} />);
    expect(screen.getByRole('listbox')).toBeInTheDocument();
  });

  it('cards have option role', () => {
    render(<Hand cards={['sA', 'h7']} />);
    const options = screen.getAllByRole('option');
    expect(options).toHaveLength(2);
  });

  it('only one card has tabIndex 0 (roving tabindex)', () => {
    render(<Hand cards={['sA', 'h7', 'dK']} />);
    const options = screen.getAllByRole('option');
    const tabbable = options.filter(o => o.tabIndex === 0);
    expect(tabbable).toHaveLength(1);
  });

  it('arrow right moves focus to next card', async () => {
    render(<Hand cards={['sA', 'h7', 'dK']} />);
    const options = screen.getAllByRole('option');
    options[0].focus();
    await userEvent.keyboard('{ArrowRight}');
    expect(options[1]).toHaveFocus();
  });

  it('space toggles card selection', async () => {
    render(<Hand cards={['sA', 'h7']} />);
    const options = screen.getAllByRole('option');
    options[0].focus();
    await userEvent.keyboard(' ');
    expect(options[0]).toHaveAttribute('aria-selected', 'true');
  });

  it('includes position context in aria-label', () => {
    render(<Hand cards={['sA', 'h7']} />);
    const options = screen.getAllByRole('option');
    // Should contain position info like "card 1 of 2"
    expect(options[0].getAttribute('aria-label')).toContain('card 1 of 2');
  });
});
```

**Deck.test.tsx -- add these tests:**
```typescript
describe('accessibility', () => {
  it('has no axe violations', async () => {
    const { container } = render(<Deck count={10} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('has no axe violations when empty', async () => {
    const { container } = render(<Deck count={0} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('draws on Enter key', async () => {
    const onDraw = vi.fn();
    render(<Deck count={10} onDraw={onDraw} />);
    const deck = screen.getByRole('button');
    await userEvent.type(deck, '{Enter}');
    expect(onDraw).toHaveBeenCalled();
  });
});
```

**CardStack.test.tsx -- add these tests:**
```typescript
describe('accessibility', () => {
  it('has no axe violations', async () => {
    const { container } = render(<CardStack cards={['sA', 'h7']} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('has group role', () => {
    render(<CardStack cards={['sA', 'h7']} />);
    expect(screen.getByRole('group')).toBeInTheDocument();
  });
});
```

**DropZone.test.tsx -- add these tests:**
```typescript
describe('accessibility', () => {
  it('has no axe violations', async () => {
    const { container } = render(<DropZone label="Discard" />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('has region role', () => {
    render(<DropZone label="Discard" />);
    expect(screen.getByRole('region')).toBeInTheDocument();
  });

  it('has aria-label from label prop', () => {
    render(<DropZone label="Discard" />);
    expect(screen.getByRole('region')).toHaveAttribute('aria-label', 'Discard');
  });
});
```

**DraggableCard.test.tsx -- add accessibility test if file exists:**
If DraggableCard has a test file, add axe scan. DraggableCard requires DndContext wrapper, so wrap in a minimal DndContext for testing:
```typescript
import { DndContext } from '@dnd-kit/core';

describe('accessibility', () => {
  it('has aria-roledescription', () => {
    render(
      <DndContext>
        <DraggableCard id="test" card="sA" />
      </DndContext>
    );
    const draggable = screen.getByTestId('draggable-card-test');
    expect(draggable).toHaveAttribute('aria-roledescription', 'draggable card');
  });
});
```

IMPORTANT: Import `userEvent` from `@testing-library/user-event` if not already imported. Use `import userEvent from '@testing-library/user-event'`.

If axe violations are found, they indicate real issues in the component ARIA structure that should be fixed in the component file, not suppressed in the test. Fix any violations by adjusting the component's ARIA attributes.
  </action>
  <verify>Run `npx vitest run src/components/` -- all tests pass including new accessibility tests. If any axe violations are found, fix the component and re-run.</verify>
  <done>Every component has axe scan passing with no violations. Keyboard interactions tested for Card, Hand, Deck. ARIA roles verified for Hand, CardStack, DropZone. Roving tabindex behavior verified for Hand.</done>
</task>

<task type="auto">
  <name>Task 2: Barrel exports for Phase 5 additions</name>
  <files>src/index.ts, src/hooks/index.ts</files>
  <action>
Update barrel exports to include all new Phase 5 hooks and utilities.

**src/hooks/index.ts** - verify these exports are present (should be from Plan 01):
```typescript
export { useRovingTabIndex } from './useRovingTabIndex';
export { useKeyboardShortcuts } from './useKeyboardShortcuts';
export type { KeyboardShortcut } from './useKeyboardShortcuts';
```

**src/index.ts** - add Phase 5 exports in a new section:

```typescript
// Accessibility hooks (Phase 5)
export { useRovingTabIndex } from './hooks';
export { useKeyboardShortcuts } from './hooks';
export type { KeyboardShortcut } from './hooks';

// Accessibility utilities (Phase 5)
export {
  formatCardForSpeech,
  formatCardLabel,
  formatFaceDownLabel,
  RANK_NAMES,
  SUIT_NAMES,
} from './utils';
```

Verify that `src/utils/index.ts` already re-exports from `./a11y` (done in Plan 01).

Run a final full test suite to confirm everything works together.
  </action>
  <verify>Run `npx vitest run` -- full suite passes. Run `npx tsc --noEmit` -- no type errors. Verify exports with: `node -e "console.log(Object.keys(require('./dist/index.js')))" 2>/dev/null` or just grep src/index.ts for the new export names.</verify>
  <done>All Phase 5 hooks (useRovingTabIndex, useKeyboardShortcuts) and utilities (formatCardForSpeech, formatCardLabel, formatFaceDownLabel, RANK_NAMES, SUIT_NAMES) are publicly exported. Full test suite passes.</done>
</task>

</tasks>

<verification>
Run `npx vitest run` -- all tests pass (existing + new accessibility tests).
Run `npx tsc --noEmit` -- no TypeScript errors.
Grep `toHaveNoViolations` in test files confirms axe scans are present for Card, Hand, Deck, CardStack, DropZone.
Grep `useRovingTabIndex|useKeyboardShortcuts|formatCardForSpeech` in src/index.ts confirms barrel exports.
</verification>

<success_criteria>
- axe-core scans pass with 0 violations for all tested components
- Card face-down test confirms "Face-down card" label (identity protection)
- Hand keyboard navigation test confirms arrow keys change focus
- Hand keyboard selection test confirms Space toggles aria-selected
- Deck keyboard test confirms Enter triggers draw
- All Phase 5 hooks and utilities are exported from src/index.ts
- KeyboardShortcut type is exported for consumers
- Full test suite green (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/05-accessibility/05-05-SUMMARY.md`
</output>
