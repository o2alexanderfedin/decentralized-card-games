---
phase: 03-drag-drop
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/DraggableCard/DraggableCard.tsx
  - src/components/DraggableCard/DraggableCard.types.ts
  - src/components/DraggableCard/DraggableCard.module.css
  - src/components/DraggableCard/DraggableCard.test.tsx
  - src/components/DraggableCard/index.ts
autonomous: true

must_haves:
  truths:
    - "A card can be picked up and dragged with mouse input"
    - "A card can be picked up and dragged with touch input"
    - "The source card becomes visually hidden (opacity 0) while its DragOverlay clone is visible"
    - "Dragging can be disabled per-card via a disabled prop"
  artifacts:
    - path: "src/components/DraggableCard/DraggableCard.tsx"
      provides: "Draggable wrapper around Card component"
      min_lines: 40
    - path: "src/components/DraggableCard/DraggableCard.types.ts"
      provides: "DraggableCard prop types"
      exports: ["DraggableCardProps"]
    - path: "src/components/DraggableCard/DraggableCard.module.css"
      provides: "Touch-action and cursor styles"
      contains: "touch-action"
  key_links:
    - from: "src/components/DraggableCard/DraggableCard.tsx"
      to: "@dnd-kit/core"
      via: "useDraggable hook"
      pattern: "useDraggable"
    - from: "src/components/DraggableCard/DraggableCard.tsx"
      to: "src/components/Card/Card.tsx"
      via: "renders Card component as child"
      pattern: "<Card"
    - from: "src/components/DraggableCard/DraggableCard.tsx"
      to: "@dnd-kit/utilities"
      via: "CSS.Translate.toString for transform"
      pattern: "CSS\\.Translate"
---

<objective>
Create the DraggableCard component that wraps the existing Card with dnd-kit's useDraggable hook.

Purpose: This is the core draggable unit -- every card that can be dragged uses this component. It handles drag transform application, touch-action CSS for iOS Safari, cursor feedback, and opacity control during drag.

Output: DraggableCard component with types, CSS module, and tests.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-drag-drop/03-RESEARCH.md
@.planning/phases/03-drag-drop/03-01-SUMMARY.md

@src/components/Card/Card.tsx
@src/components/Card/Card.types.ts
@src/types/dnd.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DraggableCard component with useDraggable integration</name>
  <files>src/components/DraggableCard/DraggableCard.types.ts, src/components/DraggableCard/DraggableCard.module.css, src/components/DraggableCard/DraggableCard.tsx, src/components/DraggableCard/index.ts</files>
  <action>
    1. Create `src/components/DraggableCard/DraggableCard.types.ts`:
       - Import `CardProps` from `../Card/Card.types`
       - Import `CardData` from `../../types`
       - Define `DraggableCardProps` extending relevant CardProps fields:
         - `id: string` -- unique identifier for dnd-kit (required)
         - `card: string | CardData` -- card identity (same as CardProps.card)
         - `disabled?: boolean` -- disable dragging (default false)
         - `sourceZoneId?: string` -- which zone this card belongs to (for drop validation)
         - Plus all visual CardProps: `isFaceUp`, `colorScheme`, `aspectRatio`, `perspective`, `spring`, `cardBack`, `onClick`, `onHover`, `onFocus`, `className`, `style`
       - Use `Omit<CardProps, 'card'> & { id: string; card: string | CardData; disabled?: boolean; sourceZoneId?: string }` for clean extension

    2. Create `src/components/DraggableCard/DraggableCard.module.css`:
       ```css
       .draggable {
         touch-action: none;
         -webkit-touch-callout: none;
         user-select: none;
         cursor: grab;
       }

       .draggable--dragging {
         opacity: 0;
         cursor: grabbing;
       }

       .draggable--disabled {
         cursor: default;
       }
       ```
       The opacity:0 on dragging is critical -- the DragOverlay shows the visible card clone. Setting opacity to 0 (not display:none) preserves the element's space in layout.

    3. Create `src/components/DraggableCard/DraggableCard.tsx`:
       - Import `useDraggable` from `@dnd-kit/core`
       - Import `CSS` from `@dnd-kit/utilities`
       - Import `Card` from `../Card`
       - Import `DragItemData` from `../../types`
       - Wrap with `React.memo` for performance (DND-06 requirement)
       - Destructure from useDraggable: `{ attributes, listeners, setNodeRef, transform, isDragging }`
       - Pass `data: { card: resolvedCardData, type: 'card', sourceZoneId }` as DragItemData to useDraggable
       - Apply inline style: `transform: CSS.Translate.toString(transform)` (only during drag; null transform = no style)
       - Apply CSS classes: base `draggable`, conditional `draggable--dragging` when isDragging, `draggable--disabled` when disabled
       - Spread `{...attributes, ...listeners}` onto the wrapper div
       - Render `<Card>` inside, passing through all CardProps
       - Export named: `export const DraggableCard = React.memo(DraggableCardInner)`

    4. Create `src/components/DraggableCard/index.ts`:
       ```typescript
       export { DraggableCard } from './DraggableCard';
       export type { DraggableCardProps } from './DraggableCard.types';
       ```
  </action>
  <verify>
    - `npx tsc --noEmit` has no type errors
    - File exists: `src/components/DraggableCard/DraggableCard.tsx`
    - Component exports DraggableCard and DraggableCardProps
  </verify>
  <done>DraggableCard component exists with useDraggable integration, touch-action CSS, and React.memo wrapping</done>
</task>

<task type="auto">
  <name>Task 2: Create DraggableCard tests</name>
  <files>src/components/DraggableCard/DraggableCard.test.tsx</files>
  <action>
    Create `src/components/DraggableCard/DraggableCard.test.tsx`:

    Testing approach: Since dnd-kit relies on getBoundingClientRect (returns zeros in jsdom), test the component's rendering and prop behavior rather than full drag simulation. Full drag interactions are E2E territory (Playwright in Phase 6).

    Mock strategy:
    - Mock `@dnd-kit/core` to provide controlled `useDraggable` return values
    - Use `vi.mock('@dnd-kit/core', async () => { ... })` pattern
    - Mock returns: `{ attributes: { role: 'button', tabIndex: 0 }, listeners: {}, setNodeRef: vi.fn(), transform: null, isDragging: false }`

    Tests:
    1. "renders Card with correct card data" -- render DraggableCard with `card="sA"`, verify Card is rendered with ace of spades
    2. "applies touch-action: none CSS class" -- verify the wrapper div has the draggable CSS class which includes touch-action: none
    3. "passes through CardProps to inner Card" -- verify isFaceUp, colorScheme, className pass through
    4. "applies dragging class when isDragging is true" -- mock useDraggable to return isDragging: true, verify draggable--dragging class is applied
    5. "applies disabled class when disabled prop is true" -- pass disabled={true}, verify the disabled class and that useDraggable receives disabled: true
    6. "passes card data via useDraggable data prop" -- verify useDraggable was called with `data: { card: ..., type: 'card' }`
    7. "applies transform from useDraggable" -- mock transform: { x: 10, y: 20, scaleX: 1, scaleY: 1 }, verify inline style includes translate
    8. "renders without transform when transform is null" -- mock transform: null, verify no transform style
    9. "is wrapped in React.memo" -- verify DraggableCard.displayName or check that component reference equality is stable

    Follow project's existing test patterns: `@testing-library/react`, `vi.mock`, `describe/it` blocks.
  </action>
  <verify>
    - `npx vitest run src/components/DraggableCard/DraggableCard.test.tsx` passes all tests
    - `npx vitest run` -- all existing tests still pass
  </verify>
  <done>DraggableCard has 9 tests covering rendering, CSS classes, prop passthrough, drag states, and memoization</done>
</task>

</tasks>

<verification>
- `npx vitest run src/components/DraggableCard/` passes all tests
- `npx tsc --noEmit` -- zero type errors
- DraggableCard renders a Card inside a div with touch-action: none
- DraggableCard applies opacity:0 class when isDragging
- DraggableCard passes card data to useDraggable's data prop
- DraggableCard is wrapped in React.memo
</verification>

<success_criteria>
- DraggableCard wraps Card with useDraggable hook
- touch-action: none and -webkit-touch-callout: none applied for iOS Safari compatibility
- isDragging state applies opacity:0 class (DragOverlay shows the visible card)
- disabled prop prevents dragging
- sourceZoneId included in drag data for validation
- Component is React.memo wrapped for performance with 50+ cards
- All tests pass including existing 201+ tests
</success_criteria>

<output>
After completion, create `.planning/phases/03-drag-drop/03-02-SUMMARY.md`
</output>
