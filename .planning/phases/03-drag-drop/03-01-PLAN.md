---
phase: 03-drag-drop
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/types/dnd.ts
  - src/types/dnd.test.ts
  - src/types/index.ts
  - src/hooks/useDragSensors.ts
  - src/hooks/useDragSensors.test.tsx
  - src/hooks/useHapticFeedback.ts
  - src/hooks/useHapticFeedback.test.ts
  - src/hooks/index.ts
autonomous: true

must_haves:
  truths:
    - "@dnd-kit/core, @dnd-kit/utilities, and @dnd-kit/modifiers are installed as production dependencies"
    - "DnD-specific types exist for drag data, drop validation, sensor config, and drag lifecycle events"
    - "useDragSensors hook returns configured MouseSensor + TouchSensor + KeyboardSensor"
    - "useHapticFeedback hook returns vibration callbacks with feature detection"
  artifacts:
    - path: "src/types/dnd.ts"
      provides: "DnD type definitions"
      contains: "DragItemData"
    - path: "src/hooks/useDragSensors.ts"
      provides: "Sensor configuration hook"
      exports: ["useDragSensors"]
    - path: "src/hooks/useHapticFeedback.ts"
      provides: "Haptic feedback hook"
      exports: ["useHapticFeedback"]
  key_links:
    - from: "src/hooks/useDragSensors.ts"
      to: "@dnd-kit/core"
      via: "useSensor, useSensors imports"
      pattern: "import.*useSensor.*@dnd-kit/core"
    - from: "src/types/dnd.ts"
      to: "src/types/card.ts"
      via: "CardData import for drag item typing"
      pattern: "import.*CardData"
---

<objective>
Install @dnd-kit dependencies and create foundational DnD types and hooks.

Purpose: Establish the type system and sensor configuration that all DnD components will depend on. This is the foundation layer -- DraggableCard, DroppableZone, and CardDndProvider all import from these files.

Output: Installed @dnd-kit packages, DnD type definitions, useDragSensors hook, useHapticFeedback hook, all with tests.
</objective>

<execution_context>
@/Users/alexanderfedin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/alexanderfedin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-drag-drop/03-RESEARCH.md

@src/types/card.ts
@src/types/containers.ts
@src/types/index.ts
@src/hooks/index.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @dnd-kit packages and create DnD type definitions</name>
  <files>package.json, src/types/dnd.ts, src/types/dnd.test.ts, src/types/index.ts</files>
  <action>
    1. Install dnd-kit packages as production dependencies:
       ```bash
       npm install @dnd-kit/core @dnd-kit/utilities @dnd-kit/modifiers
       ```
       These are production deps (not dev) because they ship with the library.

    2. Create `src/types/dnd.ts` with these type definitions:
       - `DragItemData`: Interface with `{ card: CardData; type: 'card'; sourceZoneId?: string }` -- this is what gets passed via useDraggable's `data` prop
       - `DropValidationFn`: `(card: CardData) => boolean` -- callback for custom drop validation
       - `DragLifecycleCallbacks`: Interface with optional `onDragStart`, `onDragOver`, `onDrop`, `onDropReject`, `onDragCancel` -- each receives relevant event data
       - `SensorConfig`: Interface with optional `mouseDistance` (default 5), `touchDelay` (default 200), `touchTolerance` (default 8) -- configurable sensor activation thresholds
       - `DragPreviewMode`: `'original' | 'translucent' | 'miniature'` -- how the drag overlay displays
       - `DropFeedbackMode`: `'highlight' | 'pulse' | 'outline'` -- how drop zones indicate acceptance
       - `InvalidDropBehavior`: `'snap-back' | 'reject-snap' | 'stay'` -- what happens on invalid drop
       - `CardDndProviderProps`: Interface for the provider component props (children, collisionDetection, autoScroll, sensorConfig, hapticFeedback, callbacks from DragLifecycleCallbacks)
       - Re-export `DragStartEvent`, `DragEndEvent`, `DragOverEvent` from `@dnd-kit/core` for consumer convenience

    3. Create `src/types/dnd.test.ts` with type-level tests:
       - Verify DragItemData has required `card` and `type` fields
       - Verify SensorConfig fields are all optional
       - Verify DropValidationFn signature accepts CardData and returns boolean
       - Use `expectTypeOf` from vitest for type assertions

    4. Update `src/types/index.ts` to re-export from `./dnd`:
       ```typescript
       export * from './dnd';
       ```
  </action>
  <verify>
    - `npm ls @dnd-kit/core` shows 6.3.x installed
    - `npm ls @dnd-kit/utilities` shows 3.2.x installed
    - `npm ls @dnd-kit/modifiers` shows 7.0.x installed
    - `npx vitest run src/types/dnd.test.ts` passes
    - `npx tsc --noEmit` has no type errors
  </verify>
  <done>@dnd-kit packages installed, DnD types defined and tested, types barrel updated</done>
</task>

<task type="auto">
  <name>Task 2: Create useDragSensors and useHapticFeedback hooks with tests</name>
  <files>src/hooks/useDragSensors.ts, src/hooks/useDragSensors.test.tsx, src/hooks/useHapticFeedback.ts, src/hooks/useHapticFeedback.test.ts, src/hooks/index.ts</files>
  <action>
    1. Create `src/hooks/useDragSensors.ts`:
       - Import `useSensor`, `useSensors`, `MouseSensor`, `TouchSensor`, `KeyboardSensor` from `@dnd-kit/core`
       - Import `SensorConfig` from `../types`
       - Accept optional `SensorConfig` parameter
       - Configure MouseSensor with `activationConstraint: { distance: config?.mouseDistance ?? 5 }`
       - Configure TouchSensor with `activationConstraint: { delay: config?.touchDelay ?? 200, tolerance: config?.touchTolerance ?? 8 }`
       - Configure KeyboardSensor with no options
       - Return `useSensors(mouseSensor, touchSensor, keyboardSensor)`
       - Export the hook and the `SensorConfig` type re-export for convenience

    2. Create `src/hooks/useDragSensors.test.tsx`:
       - Use the component render approach (consistent with existing hook tests in this project)
       - Create a test component that calls useDragSensors and renders a DndContext with returned sensors
       - Test: returns sensors array (not null/undefined)
       - Test: works with default config (no args)
       - Test: works with custom config `{ mouseDistance: 10, touchDelay: 300, touchTolerance: 12 }`
       - Mock `@dnd-kit/core` to verify sensor factory calls with correct activation constraints

    3. Create `src/hooks/useHapticFeedback.ts`:
       - Accept optional `enabled: boolean` parameter (default `true`)
       - Feature-detect: `const isSupported = typeof navigator !== 'undefined' && 'vibrate' in navigator`
       - Return object with:
         - `isSupported: boolean`
         - `onPickup: () => void` -- vibrate 50ms
         - `onHover: () => void` -- vibrate 20ms
         - `onDrop: () => void` -- vibrate pattern [30, 20, 30]
         - `onReject: () => void` -- vibrate pattern [50, 30, 50]
       - Each callback checks `enabled && isSupported` before calling `navigator.vibrate()`
       - Wrap return in `useMemo` keyed on `enabled` to maintain referential stability

    4. Create `src/hooks/useHapticFeedback.test.ts`:
       - Test: returns `isSupported: false` in jsdom (no vibrate API)
       - Test: when `enabled=false`, callbacks are no-ops
       - Test: when vibrate is mocked on navigator, `isSupported` is true and callbacks invoke vibrate with correct patterns
       - Mock `navigator.vibrate` as `vi.fn()` for tests that need it

    5. Update `src/hooks/index.ts` to add new hook exports:
       ```typescript
       export { useDragSensors } from './useDragSensors';
       export { useHapticFeedback } from './useHapticFeedback';
       ```
  </action>
  <verify>
    - `npx vitest run src/hooks/useDragSensors.test.tsx` passes
    - `npx vitest run src/hooks/useHapticFeedback.test.ts` passes
    - `npx tsc --noEmit` has no type errors
    - `npx vitest run` -- all existing tests still pass (no regressions)
  </verify>
  <done>useDragSensors returns configured Mouse+Touch+Keyboard sensors, useHapticFeedback provides feature-detected vibration callbacks, both hooks tested and exported</done>
</task>

</tasks>

<verification>
- `npm ls @dnd-kit/core @dnd-kit/utilities @dnd-kit/modifiers` shows all three installed
- `npx vitest run` -- all tests pass including new type, sensor, and haptic tests
- `npx tsc --noEmit` -- zero type errors
- New types importable: `import { DragItemData, SensorConfig } from './types'`
- New hooks importable: `import { useDragSensors, useHapticFeedback } from './hooks'`
</verification>

<success_criteria>
- @dnd-kit/core 6.x, @dnd-kit/utilities 3.x, @dnd-kit/modifiers 7.x installed as production dependencies
- DnD types cover drag data, validation, lifecycle, sensor config, and preview modes
- useDragSensors returns Mouse (5px) + Touch (200ms/8px) + Keyboard sensors with configurable overrides
- useHapticFeedback safely detects vibration API and provides no-op fallback
- All existing 201+ tests continue passing
</success_criteria>

<output>
After completion, create `.planning/phases/03-drag-drop/03-01-SUMMARY.md`
</output>
